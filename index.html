<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Milla Nova 3D - Prototyp 1:1 (Fáze 1)</title>
    <style>
        body { margin: 0; overflow: hidden; background: #ececec; font-family: sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; color: #333; text-align: center; width: 100%; }
        .label { position: absolute; bottom: 50px; width: 100%; text-align: center; letter-spacing: 5px; text-transform: uppercase; font-size: 12px; opacity: 0.5; }
    </style>
</head>
<body>
    <div id="ui">
        <h1 style="font-weight: 100; letter-spacing: 10px; margin: 0;">MILLA NOVA</h1>
        <p style="font-size: 10px; letter-spacing: 3px;">COUTURE</p>
    </div>
    <div class="label">Scroll to explore collection</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.2/index.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { gsap } from 'gsap';

        // --- CONFIGURACE ---
        const CONFIG = {
            radius: 18,
            cardCount: 10,
            friction: 0.95, // Setrvačnost
            lerp: 0.05,
            tiltStrength: 0.15
        };

        let targetRot = 0;
        let currentRot = 0;
        let scrollVelocity = 0;
        const mouse = new THREE.Vector2();

        // --- SCÉNA ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xececec);
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 4, 35);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const worldPivot = new THREE.Group();
        scene.add(worldPivot);

        // --- SHADER ---
        const vertexShader = `
            uniform float uBend;
            uniform float uVelocity;
            uniform float uMouseY;
            varying vec2 vUv;
            void main() {
                vUv = uv;
                vec3 pos = position;
                
                // Organická deformace podle pohybu a myši
                float wave = sin(uv.x * 3.14) * uVelocity * 0.15;
                float mouseWarp = sin(uv.y * 3.14) * uMouseY * 1.5;
                pos.z += wave + mouseWarp;

                // Matematicky správný cylindrický ohyb (bez smršťování)
                float r = 18.0; 
                float angle = pos.x / r;
                pos.z += (cos(angle * uBend) * r - r);
                pos.x = sin(angle * uBend) * r;

                gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            }
        `;

        const fragmentShader = `
            uniform sampler2D uTexture;
            varying vec2 vUv;
            void main() {
                vec4 tex = texture2D(uTexture, vUv);
                gl_FragColor = tex;
            }
        `;

        // --- KARTY ---
        const cards = [];
        const textureLoader = new THREE.TextureLoader();

        for(let i = 0; i < CONFIG.cardCount; i++) {
            const group = new THREE.Group();
            const angle = (i / CONFIG.cardCount) * Math.PI * 2;
            
            group.position.x = Math.sin(angle) * CONFIG.radius;
            group.position.z = Math.cos(angle) * CONFIG.radius;
            group.rotation.y = angle;

            const geometry = new THREE.PlaneGeometry(9, 12, 32, 32);
            const material = new THREE.ShaderMaterial({
                vertexShader,
                fragmentShader,
                uniforms: {
                    uTexture: { value: textureLoader.load(`https://picsum.photos/seed/${i+50}/800/1100`) },
                    uBend: { value: 1.0 },
                    uVelocity: { value: 0 },
                    uMouseY: { value: 0 }
                },
                side: THREE.DoubleSide
            });

            const mesh = new THREE.Mesh(geometry, material);
            group.add(mesh);
            worldPivot.add(group);
            cards.push({ group, mesh, angle });
        }

        // --- EVENTY ---
        window.addEventListener('wheel', (e) => {
            scrollVelocity -= e.deltaY * 0.00005;
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        // --- LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            // Fyzika scrollu
            scrollVelocity *= CONFIG.friction;
            currentRot += scrollVelocity;
            worldPivot.rotation.y = currentRot;

            // Tilt celého světa
            const targetPitch = -0.15 + (mouse.y * CONFIG.tiltStrength);
            worldPivot.rotation.x = THREE.MathUtils.lerp(worldPivot.rotation.x, targetPitch, 0.05);

            // Update karet
            cards.forEach(card => {
                card.mesh.material.uniforms.uVelocity.value = scrollVelocity * 50;
                card.mesh.material.uniforms.uMouseY.value = mouse.y * 0.2;
                
                // Jemné vyklonění aktivní karty dopředu (pohled na kameru)
                const worldPos = new THREE.Vector3();
                card.mesh.getWorldPosition(worldPos);
                const isFront = Math.abs(worldPos.x) < 5 && worldPos.z > 10;
                
                gsap.to(card.mesh.position, {
                    z: isFront ? 2 : 0,
                    duration: 0.5
                });
            });

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
