<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Milla Nova | Infinite Scroll Cylinder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.19/bundled/lenis.min.js"></script>
    <style>
        body { margin: 0; background: #e5e5e5; overflow-x: hidden; height: 500vh; /* Délka scrollu */ }
        canvas { position: fixed; top: 0; left: 0; outline: none; }
        #explore {
            position: fixed; width: 110px; height: 110px; background: #9e2a2b;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-family: sans-serif; font-size: 10px; text-transform: uppercase;
            pointer-events: none; z-index: 100; opacity: 0; transform: translate(-50%, -50%) scale(0);
        }
    </style>
</head>
<body>

<div id="explore">Explore</div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

    // --- SETUP ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xe5e5e5);
    const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 16;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    // --- LENIS SMOOTH SCROLL ---
    const lenis = new Lenis();
    function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    // --- CYLINDER GROUP ---
    const RADIUS = 11;
    const CARD_COUNT = 12; // Více karet pro zaplnění kruhu
    const cylinderGroup = new THREE.Group();
    scene.add(cylinderGroup);

    // --- CURVED SHADER ---
    const vertexShader = `
        uniform float uBend;
        varying vec2 vUv;
        void main() {
            vUv = uv;
            vec3 pos = position;
            float angle = pos.x / ${RADIUS}.0;
            pos.z += (cos(angle) * ${RADIUS}.0 - ${RADIUS}.0) * uBend;
            pos.x = sin(angle) * ${RADIUS}.0;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
    `;

    const cards = [];
    const texLoader = new THREE.TextureLoader();

    for (let i = 0; i < CARD_COUNT; i++) {
        const angle = (i / CARD_COUNT) * Math.PI * 2;
        
        const mat = new THREE.ShaderMaterial({
            uniforms: {
                uMap: { value: texLoader.load(`https://picsum.photos/600/900?v=${i}`) },
                uBend: { value: 0.8 },
                uOpacity: { value: 1.0 }
            },
            vertexShader,
            fragmentShader: `
                uniform sampler2D uMap;
                varying vec2 vUv;
                void main() { gl_FragColor = texture2D(uMap, vUv); }
            `,
            transparent: true,
            side: THREE.DoubleSide
        });

        const mesh = new THREE.Mesh(new THREE.PlaneGeometry(4, 5.5, 32, 1), mat);
        
        const pivot = new THREE.Group();
        pivot.position.x = Math.sin(angle) * RADIUS;
        pivot.position.z = Math.cos(angle) * RADIUS - RADIUS;
        pivot.rotation.y = angle;
        
        pivot.add(mesh);
        cylinderGroup.add(pivot);
        cards.push({ mesh, pivot, angle });
    }

    // --- SCROLL TO ROTATION ---
    lenis.on('scroll', (e) => {
        // Mapování scrollu na rotaci celého válce
        gsap.to(cylinderGroup.rotation, {
            y: e.animatedScroll * 0.002, // Rychlost rotace
            duration: 0.5
        });
    });

    // --- HOVER & PARALLAX ---
    let mouse = new THREE.Vector2();
    let parallaxTarget = new THREE.Vector2();
    const explore = document.getElementById('explore');

    window.addEventListener('mousemove', (e) => {
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        
        gsap.to(explore, { x: e.clientX, y: e.clientY, duration: 0.1 });
        parallaxTarget.set(mouse.x * 0.1, mouse.y * 0.05);

        const raycaster = new THREE.Raycaster();
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(cards.map(c => c.mesh));

        if (intersects.length > 0) {
            const hit = cards.find(c => c.mesh === intersects[0].object);
            gsap.to(hit.mesh.position, { z: 2, duration: 0.4 }); // Vysunutí
            gsap.to(explore, { opacity: 1, scale: 1, duration: 0.3 });
        } else {
            cards.forEach(c => gsap.to(c.mesh.position, { z: 0, duration: 0.4 }));
            gsap.to(explore, { opacity: 0, scale: 0, duration: 0.3 });
        }
    });

    gsap.ticker.add(() => {
        // Jemný parallax náklon
        scene.rotation.y += (parallaxTarget.x - scene.rotation.y) * 0.05;
        scene.rotation.x += (-parallaxTarget.y - scene.rotation.x) * 0.05;
        renderer.render(scene, camera);
    });

</script>
</body>
</html>
