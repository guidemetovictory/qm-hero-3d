<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Milla Nova 1:1 Fix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body { margin: 0; background: #f0f0f0; overflow: hidden; font-family: serif; }
        #canvas-container { position: absolute; inset: 0; }
        .ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; align-items: center; justify-content: center; }
        .title { font-size: 10vw; color: rgba(0,0,0,0.05); text-transform: uppercase; white-space: nowrap; }
        
        #explore {
            position: fixed; width: 100px; height: 100px; background: #9e2a2b; color: #fff;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 10px; text-transform: uppercase; pointer-events: none;
            opacity: 0; scale: 0.5; z-index: 100; transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>

<div id="explore">Explore</div>
<div class="ui"><div class="title">Milla Nova</div></div>
<div id="canvas-container"></div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

    const container = document.getElementById('canvas-container');
    const explore = document.getElementById('explore');
    
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);
    
    const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 15;

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // Skupina pro karty
    const group = new THREE.Group();
    scene.add(group);

    const textureLoader = new THREE.TextureLoader();
    const cards = [];
    const count = 7; // Celkový počet karet
    const activeIndices = [1, 2, 3, 4]; // Tyto budou funkční (vepředu)

    // Jednoduchá geometrie s prohnutím (bez bugujících shaderů)
    const cardW = 3.5, cardH = 5;
    const geometry = new THREE.PlaneGeometry(cardW, cardH, 20, 1);
    
    // Ruční ohnutí geometrie, aby se nebugovala v shaderu
    const pos = geometry.attributes.position;
    for (let i = 0; i < pos.count; i++) {
        const x = pos.getX(i);
        const z = Math.pow(Math.abs(x), 2) * 0.1; // Jemné prohnutí dozadu
        pos.setZ(i, z);
    }

    for (let i = 0; i < count; i++) {
        const mat = new THREE.MeshBasicMaterial({
            map: textureLoader.load(`https://picsum.photos/600/900?v=${i}`),
            transparent: true,
            opacity: activeIndices.includes(i) ? 1 : 0.3
        });
        
        const mesh = new THREE.Mesh(geometry, mat);
        
        // Rozmístění do oblouku
        const angle = (i - (count - 1) / 2) * 0.4; 
        mesh.position.x = Math.sin(angle) * 10;
        mesh.position.z = Math.cos(angle) * 2;
        mesh.rotation.y = -angle * 0.5;
        
        mesh.userData = { interactive: activeIndices.includes(i) };
        group.add(mesh);
        cards.push(mesh);
    }

    // Interakce přes GSAP
    let targetX = 0;
    let isHovering = false;

    window.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth) - 0.5;
        targetX = x * 2; // Rozsah pohybu

        // Pohyb kurzoru
        gsap.to(explore, {
            x: e.clientX,
            y: e.clientY,
            duration: 0.1
        });

        // Raycasting pro hover
        const mouse = new THREE.Vector2(
            (e.clientX / window.innerWidth) * 2 - 1,
            -(e.clientY / window.innerHeight) * 2 + 1
        );
        
        const raycaster = new THREE.Raycaster();
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(cards);

        if (intersects.length > 0 && intersects[0].object.userData.interactive) {
            if (!isHovering) {
                isHovering = true;
                gsap.to(explore, { opacity: 1, scale: 1, duration: 0.3 });
            }
            // Zastavení pohybu při hoveru (Hover Lock)
            targetX *= 0.2; 
        } else {
            if (isHovering) {
                isHovering = false;
                gsap.to(explore, { opacity: 0, scale: 0.5, duration: 0.3 });
            }
        }
    });

    // Plynulá animace skupiny přes GSAP tick
    gsap.ticker.add(() => {
        // Plynulé naklánění celé skupiny
        group.rotation.y += (targetX - group.rotation.y) * 0.05;
        renderer.render(scene, camera);
    });

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

</script>
</body>
</html>
