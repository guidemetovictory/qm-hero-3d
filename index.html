<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QM Hero 3D – Ring Cards</title>

  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#fff}
    #wrap{position:relative;width:100vw;height:100vh;overflow:hidden;background:#fff}
    canvas{position:absolute;inset:0;display:block;z-index:1}
    #hint{
      position:absolute; top:14px; left:14px; z-index:3;
      font: 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:#0b0b0b; opacity:.55; user-select:none; pointer-events:none;
    }
  </style>
</head>

<body>
  <div id="wrap">
    <div id="hint">Move mouse • Edge rotate • Click any card → Center → Pop • Smooth return</div>
  </div>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.module.js";

    // -----------------------------
    // Utils
    // -----------------------------
    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
    const lerp  = (a,b,t)=>a+(b-a)*t;
    const angNorm = (a)=>Math.atan2(Math.sin(a), Math.cos(a)); // [-pi,pi]

    // time-based smoothing (frame-rate independent)
    function expSmoothing(lambda, dt){
      // returns t in [0..1] for lerp
      return 1 - Math.exp(-lambda * dt);
    }

    // -----------------------------
    // Tunables (feel)
    // -----------------------------
    const T = {
      // Edge rotate
      DEAD: 0.25,
      EDGE: 0.68,
      MAX_VEL: 0.055,         // faster
      VEL_LAMBDA: 14,         // responsiveness
      DAMP: 0.86,

      // Centering spring (fast but not flash)
      CENTER_K: 0.095,
      CENTER_DAMP: 0.78,
      CENTER_DONE_ANG: 0.006,
      CENTER_DONE_VEL: 0.002,

      // Pop / return smooth
      POP_DIST: 1.15,
      POP_LAMBDA: 10,         // smooth in/out
      DIM_LAMBDA: 10,
      BACK_DIST: 0.55,        // push others back more

      // Ring retreat on focus
      RING_RETREAT_Z: -2.4,   // move ring away from camera
      RING_SCALE: 0.86,

      // Tilt
      TILT_MAX: 0.20,
      TILT_LAMBDA: 10,

      // Hover-off cancel grace
      HOVER_CANCEL_MS: 140
    };

    // -----------------------------
    // Scene
    // -----------------------------
    const wrap = document.getElementById("wrap");
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(48, wrap.clientWidth / wrap.clientHeight, 0.1, 80);
    camera.position.set(0, 0.15, 7.2);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(wrap.clientWidth, wrap.clientHeight);

