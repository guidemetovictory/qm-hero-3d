<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milla Nova 3D - 1:1 High-End Iteration</title>
    <style>
        body { margin: 0; overflow: hidden; background: #ececec; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); pointer-events: none; text-align: center; z-index: 10; }
        h1 { font-weight: 100; letter-spacing: 15px; margin: 0; color: #333; font-size: 14px; text-transform: uppercase; }
        .footer { position: absolute; bottom: 30px; width: 100%; text-align: center; letter-spacing: 5px; text-transform: uppercase; font-size: 10px; color: #888; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>Milla Nova — Couture</h1>
    </div>
    <div class="footer">Scroll to explore collection 2025</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.2/index.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { gsap } from 'gsap';

        // --- MASTER CONFIG ---
        const CONF = {
            radius: 19,
            cardWidth: 9,
            cardHeight: 12,
            cardCount: 12,
            friction: 0.94,
            lerp: 0.06,
            yTiltFactor: 0.25, // Osa Y reakce
            bloomStrength: 1.2
        };

        let targetRot = 0;
        let currentRot = 0;
        let velocity = 0;
        const mouse = new THREE.Vector2();
        const raycaster = new THREE.Raycaster();

        // --- SCÉNA & KAMERA ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xececec);
        
        const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 38);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const worldPivot = new THREE.Group();
        scene.add(worldPivot);

        // --- ADVANCED SHADER (The "Cloth/Paper" Logic) ---
        const vertexShader = `
            uniform float uTime;
            uniform float uHover;
            uniform float uVelocity;
            uniform float uMouseY;
            varying vec2 vUv;

            void main() {
                vUv = uv;
                vec3 pos = position;

                // 1. DYNAMICKÁ EXPANZE (1:1 efekt z videa)
                // Karta se rozšiřuje do stran při hoveru
                float expansion = 1.0 + (uHover * 0.22); 
                pos.x *= expansion;
                pos.y *= (1.0 + uHover * 0.04);

                // 2. HADROVÁ DEFORMACE (Vertex-level physics)
                // Rohy karty se ohýbají podle pozice myši a rychlosti
                float wave = sin(uv.x * 3.14) * uVelocity * 0.12;
                float verticalTorsion = sin(uv.y * 3.14) * uMouseY * (uHover + 0.2) * 2.5;
                pos.z += wave + verticalTorsion;

                // 3. MATEMATICKÝ CYLINDRICKÝ OHYB
                // Výpočet, který eliminuje "nudloidní" smršťování
                float r = 19.0;
                float bend = 1.0 - (uHover * 0.85); // Narovnání při hoveru
                float angle = pos.x / r;
                
                pos.z += (cos(angle * bend) * r - r);
                pos.x = sin(angle * bend) * r;

                // 4. Z-DEPTH OFFSET
                pos.z += uHover * 6.0;

                gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            }
        `;

        const fragmentShader = `
            uniform sampler2D uTexture;
            uniform float uHover;
            varying vec2 vUv;

            void main() {
                vec4 tex = texture2D(uTexture, vUv);
                // Jemné zesvětlení při hoveru pro "luxusní" nádech
                tex.rgb += uHover * 0.05;
                gl_FragColor = tex;
            }
        `;

        // --- TVORBA KARET ---
        const cards = [];
        const texLoader = new THREE.TextureLoader();

        for (let i = 0; i < CONF.cardCount; i++) {
            const wrapper = new THREE.Group();
            const angle = (i / CONF.cardCount) * Math.PI * 2;
            
            wrapper.position.x = Math.sin(angle) * CONF.radius;
            wrapper.position.z = Math.cos(angle) * CONF.radius;
            wrapper.rotation.y = angle;

            const geo = new THREE.PlaneGeometry(CONF.cardWidth, CONF.cardHeight, 40, 40);
            const mat = new THREE.ShaderMaterial({
                uniforms: {
                    uTexture: { value: texLoader.load(`https://picsum.photos/seed/${i + 120}/1000/1400`) },
                    uTime: { value: 0 },
                    uHover: { value: 0 },
                    uVelocity: { value: 0 },
                    uMouseY: { value: 0 }
                },
                vertexShader,
                fragmentShader,
                side: THREE.DoubleSide
            });

            const mesh = new THREE.Mesh(geo, mat);
            wrapper.add(mesh);
            worldPivot.add(wrapper);
            cards.push({ wrapper, mesh, angle });
        }

        // --- INTERAKCE ---
        window.addEventListener('wheel', (e) => {
            velocity -= e.deltaY * 0.00006;
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        // --- HLAVNÍ LOOP (The Engine) ---
        function animate(time) {
            requestAnimationFrame(animate);

            // 1. Fyzika rotace válce
            velocity *= CONF.friction;
            currentRot += velocity;
            worldPivot.rotation.y = currentRot;

            // 2. Globální Pitch (osa Y světa) - Teď už je viditelná!
            const globalPitch = -0.15 + (mouse.y * CONF.yTiltFactor);
            worldPivot.rotation.x = THREE.MathUtils.lerp(worldPivot.rotation.x, globalPitch, 0.08);

            // 3. Raycasting pro Hover
            raycaster.setFromCamera(mouse, camera);
            const hits = raycaster.intersectObjects(cards.map(c => c.mesh));
            const hoveredMesh = hits.length > 0 ? hits[0].object : null;

            // 4. Update jednotlivých karet
            cards.forEach(card => {
                const isHovered = hoveredMesh === card.mesh;
                const m = card.mesh.material.uniforms;

                m.uTime.value = time * 0.001;
                m.uVelocity.value = velocity * 40;
                
                if (isHovered) {
                    card.mesh.renderOrder = 100; // Priorita před ostatními
                    gsap.to(m.uHover, { value: 1.0, duration: 0.6, ease: "power3.out" });
                    m.uMouseY.value = THREE.MathUtils.lerp(m.uMouseY.value, mouse.y, 0.1);
                } else {
                    gsap.to(m.uHover, { 
                        value: 0.0, 
                        duration: 0.8, 
                        ease: "power2.inOut",
                        onComplete: () => { if(m.uHover.value === 0) card.mesh.renderOrder = 0; }
                    });
                }
            });

            renderer.render(scene, camera);
        }

        animate(0);

        // Responzivita
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
